name: ğŸ”§ Multiple APK Modification Methods

on:
  workflow_dispatch:
    inputs:
      apk_url:
        description: 'APK ë‹¤ìš´ë¡œë“œ URL'
        required: true
        default: 'https://github.com/user/repo/releases/download/v1.0/app.apk'

env:
  ORIGINAL_APK: original_backup.apk

jobs:
  modify-apk-multiple-methods:
    runs-on: ubuntu-latest
    
    steps:
    # âœ… í™˜ê²½ ì„¤ì •
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup Android SDK
      uses: android-actions/setup-android@v3
      with:
        api-level: 33
        build-tools: 34.0.0

    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y unzip zip openjdk-11-jdk wget curl xxd
        
        # í•„ìˆ˜ ë„êµ¬ ì„¤ì¹˜
        echo "ğŸ“¥ í•„ìˆ˜ ë„êµ¬ ì„¤ì¹˜ ì¤‘..."
        
        # apktool ì„¤ì¹˜
        wget https://raw.githubusercontent.com/iBotPeaches/Apktool/master/scripts/linux/apktool -O apktool
        wget https://bitbucket.org/iBotPeaches/apktool/downloads/apktool_2.9.3.jar -O apktool.jar
        chmod +x apktool
        sudo mv apktool apktool.jar /usr/local/bin/
        
        echo "âœ… í™˜ê²½ ì„¤ì • ì™„ë£Œ"

    # âœ… ì›ë³¸ APK ë‹¤ìš´ë¡œë“œ
    - name: Download original APK
      run: |
        echo "=== ğŸ“¥ ì›ë³¸ APK ë‹¤ìš´ë¡œë“œ ==="
        wget "${{ github.event.inputs.apk_url }}" -O "$ORIGINAL_APK"
        
        if [ -f "$ORIGINAL_APK" ]; then
          echo "âœ… APK ë‹¤ìš´ë¡œë“œ ì„±ê³µ"
          echo "ğŸ“Š íŒŒì¼ í¬ê¸°: $(du -h $ORIGINAL_APK | cut -f1)"
          echo "ğŸ“‹ íŒŒì¼ ì •ë³´: $(file $ORIGINAL_APK)"
        else
          echo "âŒ APK ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨"
          exit 1
        fi

    # âœ… ë°©ë²• 1: aapt2 ì‚¬ìš©í•œ ì •êµí•œ APK ìˆ˜ì •
    - name: Method 1 - Precise APK modification with aapt2
      run: |
        echo "=== ğŸ”§ ë°©ë²• 1: aapt2ë¥¼ ì‚¬ìš©í•œ ì •êµí•œ APK ìˆ˜ì • ==="
        
        if [ -f "${ORIGINAL_APK:-}" ]; then
          echo "ğŸ¯ aapt2ë¡œ ì •êµí•˜ê²Œ ìˆ˜ì •í•´ë³´ê² ìŠµë‹ˆë‹¤..."
          
          # aapt2 ì„¤ì¹˜ í™•ì¸
          if command -v aapt2 >/dev/null 2>&1; then
            echo "âœ… aapt2 ì´ë¯¸ ì„¤ì¹˜ë¨"
          else
            echo "ğŸ“¥ aapt2 ì„¤ì¹˜ ì¤‘..."
            # Android SDKì˜ aapt2 ì‚¬ìš©
            AAPT2_PATH="$HOME/android-sdk/build-tools/34.0.0/aapt2"
            if [ -f "$AAPT2_PATH" ]; then
              echo "âœ… aapt2 ë°œê²¬: $AAPT2_PATH"
              sudo ln -sf "$AAPT2_PATH" /usr/local/bin/aapt2 || true
            else
              echo "âŒ aapt2 ì—†ìŒ - ì„¤ì¹˜ ì‹œë„"
              echo "aapt2 ì„¤ì¹˜ë¥¼ ìœ„í•´ build-tools ì¬ì„¤ì¹˜..."
            fi
          fi
          
          # 1ë‹¨ê³„: ì›ë³¸ APK ë¶„í•´ (aapt2 ë°©ì‹)
          echo "ğŸ“¦ 1ë‹¨ê³„: APK ë¦¬ì†ŒìŠ¤ ì¶”ì¶œ (aapt2)..."
          mkdir -p aapt2_work
          cd aapt2_work
          
          # APKë¥¼ ZIPìœ¼ë¡œ ì²˜ë¦¬í•´ì„œ íŒŒì¼ë“¤ ì¶”ì¶œ
          cp "../$ORIGINAL_APK" original.apk
          unzip -q original.apk
          
          echo "âœ… APK íŒŒì¼ ì¶”ì¶œ ì™„ë£Œ"
          ls -la | head -10
          
          # 2ë‹¨ê³„: ë§¤ë‹ˆí˜ìŠ¤íŠ¸ë¥¼ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜ (aapt2 dump)
          echo "ğŸ“„ 2ë‹¨ê³„: ë§¤ë‹ˆí˜ìŠ¤íŠ¸ í…ìŠ¤íŠ¸ ë³€í™˜..."
          if aapt2 dump badging original.apk > package_info.txt 2>&1; then
            echo "âœ… aapt2 dump ì„±ê³µ"
            head -5 package_info.txt
          else
            echo "âŒ aapt2 dump ì‹¤íŒ¨"
            cat package_info.txt | head -5
          fi
          
          # aaptë¡œ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ XML í˜•íƒœë¡œ ì¶”ì¶œ
          echo "ğŸ“‹ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ XML ì¶”ì¶œ..."
          if aapt dump xmltree original.apk AndroidManifest.xml > manifest_readable.xml 2>&1; then
            echo "âœ… ë§¤ë‹ˆí˜ìŠ¤íŠ¸ XML ì¶”ì¶œ ì„±ê³µ"
            echo "í˜„ì¬ receiver ê°œìˆ˜: $(grep -c "receiver" manifest_readable.xml || echo "0")"
          else
            echo "âŒ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ XML ì¶”ì¶œ ì‹¤íŒ¨"
          fi
          
          # 3ë‹¨ê³„: ë°”ì´ë„ˆë¦¬ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ì§ì ‘ ë¶„ì„
          echo "ğŸ” 3ë‹¨ê³„: ë°”ì´ë„ˆë¦¬ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ë¶„ì„..."
          echo "ë§¤ë‹ˆí˜ìŠ¤íŠ¸ íŒŒì¼ ì •ë³´:"
          ls -la AndroidManifest.xml
          echo "ë§¤ë‹ˆí˜ìŠ¤íŠ¸ í—¥ìŠ¤ ë¤í”„ (ì²˜ìŒ 64ë°”ì´íŠ¸):"
          hexdump -C AndroidManifest.xml | head -4
          
          cd ..
          echo "aapt2 ë°©ë²• 1ë‹¨ê³„ ì™„ë£Œ"
        fi

    # âœ… ë°©ë²• 2: ë°”ì´ë„ˆë¦¬ í—¥ìŠ¤ ì—ë””í„° ë°©ì‹
    - name: Method 2 - Binary hex editor approach
      run: |
        echo "=== ğŸ”¬ ë°©ë²• 2: ë°”ì´ë„ˆë¦¬ í—¥ìŠ¤ ì—ë””í„° ë°©ì‹ ==="
        
        if [ -f "${ORIGINAL_APK:-}" ]; then
          echo "ğŸ¯ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ë°”ì´ë„ˆë¦¬ë¥¼ ì§ì ‘ ë¶„ì„í•˜ê³  ìˆ˜ì •í•´ë³´ê² ìŠµë‹ˆë‹¤..."
          
          mkdir -p hex_work
          cd hex_work
          
          # APKì—ì„œ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ì¶”ì¶œ
          unzip -j "../$ORIGINAL_APK" AndroidManifest.xml
          
          if [ -f "AndroidManifest.xml" ]; then
            echo "âœ… ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ì¶”ì¶œ ì™„ë£Œ"
            
            # ë°”ì´ë„ˆë¦¬ ë¶„ì„
            echo "ğŸ“Š ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ë°”ì´ë„ˆë¦¬ ì •ë³´:"
            echo "í¬ê¸°: $(wc -c < AndroidManifest.xml) bytes"
            echo "íŒŒì¼ íƒ€ì…: $(file AndroidManifest.xml)"
            
            # ë¬¸ìì—´ í…Œì´ë¸” ì°¾ê¸°
            echo "ğŸ” ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ë‚´ ë¬¸ìì—´ ê²€ìƒ‰:"
            strings AndroidManifest.xml | grep -E "(receiver|activity|AlarmReceiver)" | head -10 || echo "ê´€ë ¨ ë¬¸ìì—´ ì—†ìŒ"
            
            # receiver íŒ¨í„´ ê²€ìƒ‰
            echo "ğŸ“¡ receiver ê´€ë ¨ ë°”ì´ë„ˆë¦¬ íŒ¨í„´ ê²€ìƒ‰:"
            xxd AndroidManifest.xml | grep -i "receiver" || echo "receiver ë°”ì´ë„ˆë¦¬ íŒ¨í„´ ì—†ìŒ"
            
            # application íƒœê·¸ ìœ„ì¹˜ ì°¾ê¸°
            echo "ğŸ“± application íƒœê·¸ ìœ„ì¹˜ ê²€ìƒ‰:"
            xxd AndroidManifest.xml | grep -i "application" | head -3 || echo "application íƒœê·¸ ì°¾ê¸° ì‹¤íŒ¨"
            
            # ë§¤ë‹ˆí˜ìŠ¤íŠ¸ êµ¬ì¡° ë¶„ì„ì„ ìœ„í•œ ë°”ì´ë„ˆë¦¬ ë¤í”„
            echo "ğŸ—‚ï¸ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ êµ¬ì¡° ë¶„ì„:"
            echo "ì²« 32ë°”ì´íŠ¸ (í—¤ë”):"
            xxd AndroidManifest.xml | head -2
            echo "ë§ˆì§€ë§‰ 32ë°”ì´íŠ¸:"
            xxd AndroidManifest.xml | tail -2
            
            # ë°±ì—… ìƒì„±
            cp AndroidManifest.xml AndroidManifest.xml.backup
            echo "âœ… ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ë°±ì—… ì™„ë£Œ"
            
          else
            echo "âŒ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ì¶”ì¶œ ì‹¤íŒ¨"
          fi
          
          cd ..
        fi

    # âœ… ë°©ë²• 3: baksmali/smali (DEX ë ˆë²¨ ìˆ˜ì •)
    - name: Method 3 - baksmali/smali DEX level modification
      run: |
        echo "=== âš™ï¸ ë°©ë²• 3: baksmali/smali DEX ë ˆë²¨ ìˆ˜ì • ==="
        
        if [ -f "${ORIGINAL_APK:-}" ]; then
          echo "ğŸ¯ DEX íŒŒì¼ ë ˆë²¨ì—ì„œ ìˆ˜ì •ì„ ì‹œë„í•´ë³´ê² ìŠµë‹ˆë‹¤..."
          
          # baksmali/smali ë„êµ¬ ë‹¤ìš´ë¡œë“œ
          echo "ğŸ“¥ baksmali/smali ë„êµ¬ ë‹¤ìš´ë¡œë“œ..."
          wget -q https://bitbucket.org/JesusFreke/smali/downloads/baksmali-2.5.2.jar -O baksmali.jar
          wget -q https://bitbucket.org/JesusFreke/smali/downloads/smali-2.5.2.jar -O smali.jar
          
          if [ -f "baksmali.jar" ] && [ -f "smali.jar" ]; then
            echo "âœ… baksmali/smali ë‹¤ìš´ë¡œë“œ ì™„ë£Œ"
            
            mkdir -p dex_work
            cd dex_work
            
            # APKì—ì„œ classes.dex ì¶”ì¶œ
            unzip -j "../$ORIGINAL_APK" "classes*.dex"
            
            if [ -f "classes.dex" ]; then
              echo "âœ… classes.dex ì¶”ì¶œ ì™„ë£Œ"
              echo "DEX íŒŒì¼ í¬ê¸°: $(du -h classes.dex | cut -f1)"
              
              # DEXë¥¼ smali ì½”ë“œë¡œ ë””ì»´íŒŒì¼
              echo "ğŸ”§ DEX â†’ smali ë””ì»´íŒŒì¼..."
              java -jar ../baksmali.jar disassemble classes.dex -o smali_out
              
              if [ -d "smali_out" ]; then
                echo "âœ… smali ë””ì»´íŒŒì¼ ì„±ê³µ"
                echo "ìƒì„±ëœ smali íŒŒì¼ ê°œìˆ˜: $(find smali_out -name "*.smali" | wc -l)"
                
                # ë©”ì¸ ì•¡í‹°ë¹„í‹° ì°¾ê¸°
                echo "ğŸ” ë©”ì¸ ì•¡í‹°ë¹„í‹° íŒŒì¼ ì°¾ê¸°:"
                find smali_out -name "*Activity*.smali" | head -5
                
                # PythonActivity ì°¾ê¸°
                PYTHON_ACTIVITY=$(find smali_out -name "*PythonActivity*.smali" | head -1)
                if [ -n "$PYTHON_ACTIVITY" ]; then
                  echo "âœ… PythonActivity ë°œê²¬: $PYTHON_ACTIVITY"
                  echo "íŒŒì¼ í¬ê¸°: $(wc -l < "$PYTHON_ACTIVITY") ì¤„"
                  
                  # Activity ë‚´ìš© ì¼ë¶€ í™•ì¸
                  echo "ğŸ“„ PythonActivity ì¼ë¶€ ë‚´ìš©:"
                  head -20 "$PYTHON_ACTIVITY"
                  
                else
                  echo "âŒ PythonActivity ì—†ìŒ"
                fi
                
                # BroadcastReceiver í´ë˜ìŠ¤ ì¶”ê°€ ì¤€ë¹„
                echo "ğŸ“¡ BroadcastReceiver í´ë˜ìŠ¤ ìƒì„± ì¤€ë¹„..."
                mkdir -p smali_out/org/kivy/skkutimetable/doublecheck
                
                # ê°„ë‹¨í•œ AlarmReceiver smali ì½”ë“œ ìƒì„± (íŒŒì¼ë¡œ ì§ì ‘ ì‘ì„±)
                echo "ğŸ”§ AlarmReceiver.smali íŒŒì¼ ìƒì„±..."
                cat > smali_out/org/kivy/skkutimetable/doublecheck/AlarmReceiver.smali <<'EOF'
.class public Lorg/kivy/skkutimetable/doublecheck/AlarmReceiver;
.super Landroid/content/BroadcastReceiver;

.method public constructor <init>()V
    .locals 0
    invoke-direct {p0}, Landroid/content/BroadcastReceiver;-><init>()V
    return-void
.end method

.method public onReceive(Landroid/content/Context;Landroid/content/Intent;)V
    .locals 2
    const-string v0, "AlarmReceiver"
    const-string v1, "Boot completed - alarm restore needed"
    invoke-static {v0, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    return-void
.end method
EOF
                
                echo "âœ… AlarmReceiver.smali ìƒì„± ì™„ë£Œ"
                
                # smali â†’ DEX ì¬ì»´íŒŒì¼
                echo "ğŸ”¨ smali â†’ DEX ì¬ì»´íŒŒì¼..."
                java -jar ../smali.jar assemble smali_out -o classes_modified.dex
                
                if [ -f "classes_modified.dex" ]; then
                  echo "âœ… DEX ì¬ì»´íŒŒì¼ ì„±ê³µ"
                  echo "ìˆ˜ì •ëœ DEX í¬ê¸°: $(du -h classes_modified.dex | cut -f1)"
                else
                  echo "âŒ DEX ì¬ì»´íŒŒì¼ ì‹¤íŒ¨"
                fi
                
              else
                echo "âŒ smali ë””ì»´íŒŒì¼ ì‹¤íŒ¨"
              fi
              
            else
              echo "âŒ classes.dex ì¶”ì¶œ ì‹¤íŒ¨"
            fi
            
            cd ..
          else
            echo "âŒ baksmali/smali ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨"
          fi
        fi

    # âœ… ë°©ë²• 4: APK í•©ì„± (íŒŒì¼ êµì²´)
    - name: Method 4 - APK synthesis (file replacement)
      run: |
        echo "=== ğŸ”„ ë°©ë²• 4: APK í•©ì„± (íŒŒì¼ êµì²´) ==="
        
        if [ -f "${ORIGINAL_APK:-}" ]; then
          echo "ğŸ¯ ZIP ë ˆë²¨ì—ì„œ íŒŒì¼ì„ êµì²´í•´ë³´ê² ìŠµë‹ˆë‹¤..."
          
          mkdir -p synthesis_work
          cd synthesis_work
          
          # 1. ì›ë³¸ APK ë³µì‚¬
          cp "../$ORIGINAL_APK" base.apk
          
          # 2. ê°„ë‹¨í•œ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ìƒì„± (íŒŒì¼ë¡œ ì§ì ‘ ì‘ì„±)
          echo "ğŸ“ ìˆ˜ì •ëœ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ìƒì„±..."
          cat > AndroidManifest_text.xml <<'EOF'
<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    package="org.kivy.skkutimetable.doublecheck"
    android:versionCode="10211"
    android:versionName="0.1">
    
    <uses-permission android:name="android.permission.INTERNET" />
    <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
    <uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" />
    <uses-permission android:name="android.permission.RECEIVE_BOOT_COMPLETED" />
    <uses-permission android:name="android.permission.WAKE_LOCK" />
    <uses-permission android:name="android.permission.VIBRATE" />
    
    <application android:label="DoubleCheck" android:icon="@mipmap/icon">
        <activity android:name="org.kivy.android.PythonActivity"
                  android:label="DoubleCheck"
                  android:exported="true">
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />
                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>
        </activity>
        
        <service android:name="org.kivy.android.PythonService" android:process=":pythonservice" />
        
        <receiver android:name="org.kivy.skkutimetable.doublecheck.AlarmReceiver"
                  android:enabled="true"
                  android:exported="true">
            <intent-filter>
                <action android:name="android.intent.action.BOOT_COMPLETED" />
            </intent-filter>
        </receiver>
        
    </application>
</manifest>
EOF
          
          # 3. aaptë¥¼ ì‚¬ìš©í•´ì„œ í…ìŠ¤íŠ¸ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ë¥¼ ë°”ì´ë„ˆë¦¬ë¡œ ë³€í™˜
          echo "ğŸ”„ í…ìŠ¤íŠ¸ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ â†’ ë°”ì´ë„ˆë¦¬ ë³€í™˜..."
          
          # ì„ì‹œ ë¦¬ì†ŒìŠ¤ ë””ë ‰í† ë¦¬ ìƒì„±
          mkdir -p temp_resources/res/values
          echo '<?xml version="1.0" encoding="utf-8"?><resources></resources>' > temp_resources/res/values/strings.xml
          
          # aaptë¡œ ë°”ì´ë„ˆë¦¬ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ìƒì„± ì‹œë„
          if aapt package -f -M AndroidManifest_text.xml -S temp_resources/res -I "$ANDROID_HOME/platforms/android-33/android.jar" -F temp.apk 2>/dev/null; then
            echo "âœ… ë°”ì´ë„ˆë¦¬ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ìƒì„± ì„±ê³µ"
            
            # ìƒì„±ëœ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ì¶”ì¶œ
            unzip -j temp.apk AndroidManifest.xml -d .
            if [ -f "AndroidManifest.xml" ]; then
              echo "âœ… ìƒˆ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ì¶”ì¶œ ì™„ë£Œ"
              echo "ìƒˆ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ í¬ê¸°: $(wc -c < AndroidManifest.xml) bytes"
              
              # 4. ì›ë³¸ APKì— ìƒˆ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ì‚½ì…
              echo "ğŸ”§ ì›ë³¸ APKì— ìƒˆ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ì‚½ì…..."
              zip base.apk AndroidManifest.xml
              
              # 5. ê²°ê³¼ APK ê²€ì¦
              echo "âœ… í•©ì„± APK ìƒì„± ì™„ë£Œ"
              mv base.apk synthesis_fixed.apk
              
              # ê²€ì¦
              if aapt dump badging synthesis_fixed.apk >/dev/null 2>&1; then
                echo "âœ… í•©ì„± APK êµ¬ì¡° ìœ íš¨"
                echo "ğŸ“‹ í•©ì„± APK ì •ë³´:"
                aapt dump badging synthesis_fixed.apk | head -5
              else
                echo "âŒ í•©ì„± APK êµ¬ì¡° ì˜¤ë¥˜"
              fi
              
            else
              echo "âŒ ìƒˆ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ì¶”ì¶œ ì‹¤íŒ¨"
            fi
          else
            echo "âŒ ë°”ì´ë„ˆë¦¬ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ìƒì„± ì‹¤íŒ¨"
          fi
          
          cd ..
        fi

    # âœ… ë°©ë²• 5: Android Studio í”„ë¡œì íŠ¸ ë³€í™˜
    - name: Method 5 - Convert to Android Studio project
      run: |
        echo "=== ğŸ—ï¸ ë°©ë²• 5: Android Studio í”„ë¡œì íŠ¸ ë³€í™˜ ==="
        
        if [ -f "${ORIGINAL_APK:-}" ]; then
          echo "ğŸ¯ APK â†’ Android Studio í”„ë¡œì íŠ¸ ë³€í™˜ ì‹œë„..."
          
          mkdir -p studio_work
          cd studio_work
          
          # jadx ë„êµ¬ ë‹¤ìš´ë¡œë“œ (APK â†’ Java ì†ŒìŠ¤ ë³€í™˜)
          echo "ğŸ“¥ jadx ë„êµ¬ ë‹¤ìš´ë¡œë“œ..."
          wget -q https://github.com/skylot/jadx/releases/download/v1.4.7/jadx-1.4.7.zip -O jadx.zip
          
          if [ -f "jadx.zip" ]; then
            unzip -q jadx.zip
            chmod +x jadx-1.4.7/bin/jadx
            
            echo "âœ… jadx ì„¤ì¹˜ ì™„ë£Œ"
            
            # APKë¥¼ Java í”„ë¡œì íŠ¸ë¡œ ë³€í™˜
            echo "ğŸ”„ APK â†’ Java ì†ŒìŠ¤ ë³€í™˜..."
            ./jadx-1.4.7/bin/jadx "../$ORIGINAL_APK" -d java_project
            
            if [ -d "java_project" ]; then
              echo "âœ… Java í”„ë¡œì íŠ¸ ë³€í™˜ ì„±ê³µ"
              
              # ë§¤ë‹ˆí˜ìŠ¤íŠ¸ í™•ì¸
              if [ -f "java_project/resources/AndroidManifest.xml" ]; then
                echo "âœ… ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ë°œê²¬"
                echo "ğŸ“„ í˜„ì¬ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ë‚´ìš©:"
                head -20 java_project/resources/AndroidManifest.xml
                
                # ë§¤ë‹ˆí˜ìŠ¤íŠ¸ì— receiver ì¶”ê°€
                echo "ğŸ“¡ receiver ì¶”ê°€ ì¤‘..."
                cp java_project/resources/AndroidManifest.xml java_project/resources/AndroidManifest.xml.backup
                
                # receiver íƒœê·¸ ì‚½ì…
                sed -i '/<\/application>/i\        <receiver android:name="org.kivy.skkutimetable.doublecheck.AlarmReceiver" android:enabled="true" android:exported="true">\
            <intent-filter>\
                <action android:name="android.intent.action.BOOT_COMPLETED" />\
            </intent-filter>\
        </receiver>' java_project/resources/AndroidManifest.xml
                
                echo "âœ… ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ìˆ˜ì • ì™„ë£Œ"
                echo "ğŸ“‹ ìˆ˜ì •ëœ ë§¤ë‹ˆí˜ìŠ¤íŠ¸:"
                grep -A 10 -B 5 "AlarmReceiver" java_project/resources/AndroidManifest.xml || echo "ì¶”ê°€ ì‹¤íŒ¨"
                
              else
                echo "âŒ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ì—†ìŒ"
              fi
              
              # í”„ë¡œì íŠ¸ êµ¬ì¡° í™•ì¸
              echo "ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°:"
              find java_project -type f -name "*.xml" | head -10
              
            else
              echo "âŒ Java í”„ë¡œì íŠ¸ ë³€í™˜ ì‹¤íŒ¨"
            fi
          else
            echo "âŒ jadx ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨"
          fi
          
          cd ..
        fi

    # âœ… ëª¨ë“  ë°©ë²• ê²°ê³¼ ë¹„êµ
    - name: Compare all methods results
      run: |
        echo "=== ğŸ“Š ëª¨ë“  ë°©ë²• ê²°ê³¼ ë¹„êµ ==="
        
        echo "ğŸ¯ ìƒì„±ëœ APK íŒŒì¼ë“¤:"
        find . -name "*.apk" -exec echo "{}:" \; -exec du -h {} \; 2>/dev/null || echo "APK íŒŒì¼ ì—†ìŒ"
        
        echo ""
        echo "ğŸ“‹ ê° ë°©ë²•ë³„ ì„±ê³µ/ì‹¤íŒ¨ ìƒíƒœ:"
        
        # ë°©ë²• 1: aapt2
        if [ -d "aapt2_work" ]; then
          echo "âœ… ë°©ë²• 1 (aapt2): ì‹œë„ë¨"
        else
          echo "âŒ ë°©ë²• 1 (aapt2): ì‹¤íŒ¨"
        fi
        
        # ë°©ë²• 2: í—¥ìŠ¤ ì—ë””í„°
        if [ -f "hex_work/AndroidManifest.xml" ]; then
          echo "âœ… ë°©ë²• 2 (í—¥ìŠ¤): ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ì¶”ì¶œë¨"
        else
          echo "âŒ ë°©ë²• 2 (í—¥ìŠ¤): ì‹¤íŒ¨"
        fi
        
        # ë°©ë²• 3: baksmali
        if [ -f "dex_work/classes_modified.dex" ]; then
          echo "âœ… ë°©ë²• 3 (baksmali): DEX ìˆ˜ì •ë¨"
        else
          echo "âŒ ë°©ë²• 3 (baksmali): ì‹¤íŒ¨"
        fi
        
        # ë°©ë²• 4: í•©ì„±
        if [ -f "synthesis_work/synthesis_fixed.apk" ]; then
          echo "âœ… ë°©ë²• 4 (í•©ì„±): APK ìƒì„±ë¨"
        else
          echo "âŒ ë°©ë²• 4 (í•©ì„±): ì‹¤íŒ¨"
        fi
        
        # ë°©ë²• 5: Studio
        if [ -f "studio_work/java_project/resources/AndroidManifest.xml" ]; then
          echo "âœ… ë°©ë²• 5 (Studio): í”„ë¡œì íŠ¸ ë³€í™˜ë¨"
        else
          echo "âŒ ë°©ë²• 5 (Studio): ì‹¤íŒ¨"
        fi
        
        echo ""
        echo "ğŸ’¡ ë‹¤ìŒ ë‹¨ê³„: ê°€ì¥ ì„±ê³µí•œ ë°©ë²•ìœ¼ë¡œ ìµœì¢… APK ìƒì„±"

    # âœ… ê²°ê³¼ë¬¼ ì—…ë¡œë“œ
    - name: Upload results
      uses: actions/upload-artifact@v4
      with:
        name: apk-modification-results
        path: |
          *.apk
          */AndroidManifest.xml
          */manifest_readable.xml
          */classes_modified.dex
          */synthesis_fixed.apk
        retention-days: 7
